@page "/Product/{id:int}"
@inject IProductService ProductService
@inject ICartService CartService

@if(product == null){
    <span>@ProductService.Message</span>
}
else
{

    <section class="navigate-section">
        <div class="navigate">
            <div class="d-flex flex-column">
                <div class="fs-4 c-2 mt-2">@product.Title</div>
            </div>
            <div class="d-flex align-items-center">
                <span class="c-2 d-flex align-items-center me-2">
                    <i class="fa-solid fa-share-nodes fs-4 me-2"></i>
                    <font class="fs-4 fw-semibold">Paylaş:</font>
                </span>
                <span class="d-flex align-items-center">
                    <a href="#!" class="me-2 c-2"><i class="fa-solid fa-envelope fs-4 pt-1"></i></a>
                    <a href="#!" class="me-2"><img height="31" src="assets/images/icons/wp-ico.png" alt=""></a>
                    <a href="#!"><img height="29" src="assets/images/icons/telegram-ico.png" alt=""></a>
                </span>
            </div>
        </div>
    </section>
    <section class="mt-5">
        <div class="custom-c-wrapper d-flex align-items-start justify-content-between flex-wrap rsp-1">
            <div class="p-img">
                <img src="@product.ImageURL" alt="">
            </div>
            <div class="p-desc">
                <div class="desc-boxes">
                    <div class="custom-list">
                        <div class="list-first">Ürünün Kategorisi:</div>
                        @if (product.Variants != null && product.Variants.Count > 1)
                        {
                            <div class="list-second text-decoration-underline">
                                <select class="form-select" @bind="currentTypeId">
                                    @foreach (var item in product.Variants)
                                    {
                                        <option value="@item.ProductTypeId">@item.ProductType.Name</option>
                                    }
                                </select>
                            </div>
                        }
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Ürün Değeri:</div>
                        <div class="list-second d-flex justify-content-between align-items-center">
                            0R1-25W
                            <i class="fa-regular fa-copy"></i>
                        </div>
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Tolerans:</div>
                        <div class="list-second">5%</div>
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Marka-Menşei:</div>
                        <div class="list-second text-decoration-underline">Liket</div>
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Stok Adedi:</div>
                        <div class="list-second">@product.Variants.Count()</div>
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Sipariş Kodu:</div>
                        <div class="list-second">Z167TG</div>
                    </div>
                    <div class="custom-list2">
                        <div class="list-first">Birim Fiyat:</div>
                        @if (GetSelectedVariant() != null)
                        {
                            <div class="list-second list-double">
                            @if (GetSelectedVariant().OriginalPrice > GetSelectedVariant().Price)
                            {
                                
                                <h6 class="text-muted original-price">
                                    @GetSelectedVariant().OriginalPrice TL
                                </h6>
                                
                            }
                            <h4 class="price">
                                @GetSelectedVariant().Price TL
                            </h4>
                            </div>
                        }
                        </div>
                    </div>
                <div class="buy-boxes">
                    <button class="btn-2 c-2 fs-2 d-flex align-items-center justify-content-center" @onclick="AddToCart">
                        <img height="40" src="assets/images/icons/cart-ico.png" alt="">
                        Sepete Ekle
                    </button>
                   @* <button class="btn-3 fs-2 d-flex align-items-center justify-content-center">
                        <img height="40" src="assets/images/icons/fast-ico.png" alt="">
                        Hızlı Satın Al
                    </button>*@
                </div>
                </div>

            </div>
    </section>
    <section class="mt-3 py-5">
        <div class="custom-c-wrapper d-flex justify-content-between">
            <div class="d-flex align-items-center data-download">
                <img class="me-2" src="assets/images/icons/pdf-ico.png" alt="">
                <span class="c-2 fw-semibold fs-2">Datasheet İndir</span>
            </div>
            <div class="d-flex align-items-center data-download">
                <img class="me-2" src="assets/images/icons/box-ico.png" alt="">
                <span class="c-2 fw-semibold fs-2">Toptan Satış Sipariş Formu</span>
            </div>
        </div>
    </section>
    <section class="bg-4 min-400">
        <div class="custom-c-wrapper py-4">
            <span class="fs-4 fw-semibold">Ürün Özellikleri</span>
            <p class="fs-4">
                @product.Description
            </p>
        </div>
    </section>
    <section class="bg-5">
        <div class="custom-c-wrapper2">
            <div class="row product-row">
                <div class="col d-flex justify-content-center align-items-center py-4">
                    <img height="60" class="me-3" src="assets/images/icons/fast-ico2.png" alt="">
                    <span class="c-2 fs-1 lh-1">Hızlı Kargo</span>
                </div>
                <div class="col d-flex justify-content-center align-items-center py-4">
                    <img height="60" class="me-3" src="assets/images/icons/secure-ico.png" alt="">
                    <span class="c-2 fs-1 lh-1">Güvenli Alışveriş</span>
                </div>
                <div class="col d-flex justify-content-center align-items-center py-4">
                    <img height="60" class="me-3" src="assets/images/icons/shipping-ico.png" alt="">
                    <span class="c-2 fs-1 lh-1">1000TL Üzeriz<br>Ücretsiz Kargo</span>
                </div>
            </div>
        </div>
    </section>




}


@code {
    private Product? product = null;
    private string message = string.Empty;
    private int currentTypeId = 1;

    [Parameter]
    public int Id { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        message = "loading product....";
        var result =await ProductService.GetProduct(Id);
        if(result.Success)
        {
            message = result.Message;
        }
        else
        {
            product = result.Data;
            if(product.Variants.Count>0)
            {
                currentTypeId = product.Variants[0].ProductTypeId;
            }
        }


    }
    private ProductVariant GetSelectedVariant()
    {
        var variant = product.Variants.FirstOrDefault(v => v.ProductTypeId == currentTypeId);
        return variant;
    }

    private async Task AddToCart()
    {
        var productVariant = GetSelectedVariant();
        var cartItem = new CartItem 
        {
            ProductId = productVariant.ProductId,
            ProductTypeId=productVariant.ProductTypeId
        };

        await CartService.AddToCart(cartItem);
    }
}
